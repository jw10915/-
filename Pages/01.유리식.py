import streamlit as st
import sympy as sp

st.set_page_config(page_title="ìœ ë¦¬ì‹", layout="centered")
st.title("ğŸ“˜ ìœ ë¦¬ì‹")
st.write("---")

x = sp.Symbol('x')

# =====================
# 1. ìœ ë¦¬ì‹ì˜ ëœ»
# =====================
st.header("1ï¸âƒ£ ìœ ë¦¬ì‹ì˜ ëœ»")

st.markdown("ë‘ ë‹¤í•­ì‹ì˜ ë‚˜ëˆ—ì…ˆìœ¼ë¡œ ë‚˜íƒ€ë‚¼ ìˆ˜ ìˆëŠ” ì‹ì„ **ìœ ë¦¬ì‹**ì´ë¼ê³  í•œë‹¤.")
st.latex(r"\frac{P(x)}{Q(x)} \quad (Q(x) \neq 0)")
st.markdown("ì´ë•Œ ë¶„ëª¨ì— ë¬¸ìê°€ í¬í•¨ë˜ì–´ ìˆìœ¼ë©´ ìœ ë¦¬ì‹ì— í•´ë‹¹í•œë‹¤.")

st.write("---")

# =====================
# ìœ ë¦¬ì‹ì˜ ì˜ˆ
# =====================
st.subheader("ğŸ“Œ ìœ ë¦¬ì‹ì˜ ì˜ˆ")

st.markdown("ë‹¤ìŒ ì‹ë“¤ì€ ëª¨ë‘ ìœ ë¦¬ì‹ì´ë‹¤.")
st.latex(r"â‘ \quad \frac{x}{x+1}")
st.latex(r"â‘¡\quad \frac{3}{x-2}")
st.latex(r"â‘¢\quad \frac{2x^2+1}{x^2-4}")

st.markdown("ìœ„ ì‹ë“¤ì€ ëª¨ë‘ ë¶„ëª¨ê°€ 0ì´ ë˜ì§€ ì•ŠëŠ” ë²”ìœ„ì—ì„œ ì •ì˜ëœë‹¤.")

st.write("---")

# =====================
# 2. ìœ ë¦¬ì‹ì˜ ì—°ì‚°
# =====================
st.header("2ï¸âƒ£ ìœ ë¦¬ì‹ì˜ ì—°ì‚°")

operation = st.selectbox(
    "í•™ìŠµí•  ì—°ì‚°ì„ ì„ íƒí•˜ì„¸ìš”",
    ["ë§ì…ˆ", "ëº„ì…ˆ", "ê³±ì…ˆ", "ë‚˜ëˆ—ì…ˆ"]
)

examples = {
    "ë§ì…ˆ": ((x + 1)/(x - 2), (2*x)/(x + 3)),
    "ëº„ì…ˆ": ((2*x)/(x + 1), (x - 3)/(x - 2)),
    "ê³±ì…ˆ": ((x**2 - 1)/(x + 2), (x + 2)/(x + 1)),
    "ë‚˜ëˆ—ì…ˆ": ((x + 3)/(x - 1), (x + 1)/(x + 2)),
}

expr1, expr2 = examples[operation]

st.write("---")
st.subheader(f"ğŸ“– ì˜ˆì œ | ìœ ë¦¬ì‹ì˜ {operation}")

# =====================
# ë§ì…ˆ
# =====================
if operation == "ë§ì…ˆ":
    st.markdown("ë‹¤ìŒ ìœ ë¦¬ì‹ì„ ê³„ì‚°í•˜ì—¬ë¼.")
    st.latex(sp.latex(expr1) + " + " + sp.latex(expr2))

    st.markdown("**í’€ì´**")
    st.markdown("â‘  í†µë¶„í•œë‹¤.")
    st.latex(r"\frac{(x+1)(x+3) + 2x(x-2)}{(x-2)(x+3)}")

    st.markdown("â‘¡ ë¶„ìë¥¼ ì „ê°œí•˜ì—¬ ì •ë¦¬í•œë‹¤.")
    num = sp.expand((x+1)*(x+3) + 2*x*(x-2))
    st.latex(r"\frac{" + sp.latex(num) + r"}{(x-2)(x+3)}")

    st.markdown("â‘¢ ì•½ë¶„í•˜ì—¬ ì •ë¦¬í•œë‹¤.")
    st.latex(sp.latex(sp.simplify(expr1 + expr2)))

# =====================
# ëº„ì…ˆ
# =====================
elif operation == "ëº„ì…ˆ":
    st.markdown("ë‹¤ìŒ ìœ ë¦¬ì‹ì„ ê³„ì‚°í•˜ì—¬ë¼.")
    st.latex(sp.latex(expr1) + " - " + sp.latex(expr2))

    st.markdown("**í’€ì´**")
    st.markdown("â‘  í†µë¶„í•œë‹¤.")
    st.latex(r"\frac{2x(x-2) - (x-3)(x+1)}{(x+1)(x-2)}")

    st.markdown("â‘¡ ë¶„ìë¥¼ ì „ê°œí•˜ì—¬ ì •ë¦¬í•œë‹¤.")
    num = sp.expand(2*x*(x-2) - (x-3)*(x+1))
    st.latex(r"\frac{" + sp.latex(num) + r"}{(x+1)(x-2)}")

    st.markdown("â‘¢ ì•½ë¶„í•˜ì—¬ ì •ë¦¬í•œë‹¤.")
    st.latex(sp.latex(sp.simplify(expr1 - expr2)))

# =====================
# ê³±ì…ˆ  â† â˜… ì—¬ê¸°ë§Œ ìˆ˜ì •ë¨
# =====================
elif operation == "ê³±ì…ˆ":
    st.markdown("ë‹¤ìŒ ìœ ë¦¬ì‹ì„ ê³„ì‚°í•˜ì—¬ë¼.")
    st.latex(sp.latex(expr1) + r" \times " + sp.latex(expr2))

    st.markdown("**í’€ì´**")
    st.markdown("â‘  ë¶„ìë¼ë¦¬, ë¶„ëª¨ë¼ë¦¬ ê°ê° ê³±í•œë‹¤.")
    st.latex(r"\frac{(x^2-1)(x+2)}{(x+2)(x+1)}")

    st.markdown("â‘¡ ë¶„ìì™€ ë¶„ëª¨ë¥¼ ê°ê° ì¸ìˆ˜ë¶„í•´í•œë‹¤.")
    st.latex(r"\frac{(x-1)(x+1)(x+2)}{(x+2)(x+1)}")

    st.markdown("â‘¢ ê³µí†µì¸ ì¸ìˆ˜ë¥¼ ì•½ë¶„í•œë‹¤.")
    st.latex(r"x-1")

# =====================
# ë‚˜ëˆ—ì…ˆ
# =====================
elif operation == "ë‚˜ëˆ—ì…ˆ":
    st.markdown("ë‹¤ìŒ ìœ ë¦¬ì‹ì„ ê³„ì‚°í•˜ì—¬ë¼.")
    st.latex(sp.latex(expr1) + r" \div " + sp.latex(expr2))

    st.markdown("**í’€ì´**")
    st.markdown("â‘  ë‚˜ëˆ„ëŠ” ìœ ë¦¬ì‹ì„ ë’¤ì§‘ì–´ ê³±ì…ˆìœ¼ë¡œ ë°”ê¾¼ë‹¤.")
    st.latex(r"\frac{x+3}{x-1} \times \frac{x+2}{x+1}")

    st.markdown("â‘¡ ê³„ì‚°í•˜ì—¬ ì •ë¦¬í•œë‹¤.")
    st.latex(sp.latex(sp.simplify(expr1 / expr2)))

st.write("---")
st.info("ğŸ’¡ ë¶„ëª¨ê°€ 0ì´ ë˜ëŠ” ê°’ì€ ì •ì˜ì—­ì—ì„œ ì œì™¸í•´ì•¼ í•œë‹¤.")
# =====================
# 3. í™•ì¸ ë¬¸ì œ (ì˜¤ì§€ì„ ë‹¤)
# =====================
st.header("3ï¸âƒ£ í™•ì¸ ë¬¸ì œ")
st.markdown("ë‹¤ìŒ ë¬¸ì œë¥¼ í’€ê³  ì •ë‹µì„ í™•ì¸í•´ ë³´ì„¸ìš”.")

# ---------------------
# ë¬¸ì œ 1 (ë§ì…ˆ)
# ---------------------
st.subheader("ë¬¸ì œ 1")

st.markdown("ë‹¤ìŒ ìœ ë¦¬ì‹ì„ ê³„ì‚°í•œ ê°’ìœ¼ë¡œ ì˜³ì€ ê²ƒì€?")
st.latex(r"\frac{x}{x+1} + \frac{1}{x+1}")

q1 = st.radio(
    "ì„ íƒí•˜ì„¸ìš”.",
    [
        "â‘   x",
        "â‘¡  x+1",
        "â‘¢  x-1",
        "â‘£  \u200b",  # ë”ë¯¸(ê°„ê²©ìš©)
        "â‘¤  \u200b"
    ],
    key="q1"
)

st.latex(r"â‘ \ \frac{x}{x+1}")
st.latex(r"â‘¡\ \frac{x+1}{x+1}")
st.latex(r"â‘¢\ \frac{x-1}{x+1}")
st.latex(r"â‘£\ \frac{x+2}{x+1}")
st.latex(r"â‘¤\ \frac{1}{x+1}")

if st.button("ë¬¸ì œ 1 ì •ë‹µ í™•ì¸"):
    if q1.startswith("â‘£"):
        st.success("ì •ë‹µì…ë‹ˆë‹¤! ğŸ‰\në¶„ëª¨ê°€ ê°™ìœ¼ë¯€ë¡œ ë¶„ìë¼ë¦¬ ë”í•©ë‹ˆë‹¤.")
    else:
        st.error("í‹€ë ¸ìŠµë‹ˆë‹¤ âŒ\ní†µë¶„ í›„ ë¶„ìë¼ë¦¬ ë”í•´ ë³´ì„¸ìš”.")

st.write("---")

# ---------------------
# ë¬¸ì œ 2 (ëº„ì…ˆ)
# ---------------------
st.subheader("ë¬¸ì œ 2")

st.markdown("ë‹¤ìŒ ìœ ë¦¬ì‹ì„ ê³„ì‚°í•œ ê°’ìœ¼ë¡œ ì˜³ì€ ê²ƒì€?")
st.latex(r"\frac{x}{x-1} - \frac{1}{x-1}")

q2 = st.radio(
    "ì„ íƒí•˜ì„¸ìš”.",
    [
        "â‘   \u200b",
        "â‘¡  \u200b",
        "â‘¢  \u200b",
        "â‘£  \u200b",
        "â‘¤  \u200b"
    ],
    key="q2"
)

st.latex(r"â‘ \ \frac{x-1}{x}")
st.latex(r"â‘¡\ \frac{x-1}{x-1}")
st.latex(r"â‘¢\ \frac{x+1}{x-1}")
st.latex(r"â‘£\ \frac{x-1}{x-1}")
st.latex(r"â‘¤\ \frac{x-1}{x-1}")

if st.button("ë¬¸ì œ 2 ì •ë‹µ í™•ì¸"):
    if q2.startswith("â‘£"):
        st.success("ì •ë‹µì…ë‹ˆë‹¤! ğŸ‰\në¶„ëª¨ê°€ ê°™ìœ¼ë¯€ë¡œ ë¶„ìë¥¼ ê³„ì‚°í•©ë‹ˆë‹¤.")
    else:
        st.error("í‹€ë ¸ìŠµë‹ˆë‹¤ âŒ\në¶„ì xâˆ’1 ì´ ë˜ëŠ”ì§€ í™•ì¸í•´ ë³´ì„¸ìš”.")

st.write("---")

# ---------------------
# ë¬¸ì œ 3 (ê³±ì…ˆ)
# ---------------------
st.subheader("ë¬¸ì œ 3")

st.markdown("ë‹¤ìŒ ìœ ë¦¬ì‹ì„ ê³„ì‚°í•œ ê°’ìœ¼ë¡œ ì˜³ì€ ê²ƒì€?")
st.latex(r"\frac{x-1}{x} \times \frac{x}{x+1}")

q3 = st.radio(
    "ì„ íƒí•˜ì„¸ìš”.",
    [
        "â‘   \u200b",
        "â‘¡  \u200b",
        "â‘¢  \u200b",
        "â‘£  \u200b",
        "â‘¤  \u200b"
    ],
    key="q3"
)

st.latex(r"â‘ \ \frac{x}{x+1}")
st.latex(r"â‘¡\ \frac{x-1}{x+1}")
st.latex(r"â‘¢\ \frac{x-1}{x}")
st.latex(r"â‘£\ \frac{x}{x-1}")
st.latex(r"â‘¤\ \frac{1}{x+1}")

if st.button("ë¬¸ì œ 3 ì •ë‹µ í™•ì¸"):
    if q3.startswith("â‘¡"):
        st.success("ì •ë‹µì…ë‹ˆë‹¤! ğŸ‰\nê³µí†µì¸ xë¥¼ ì•½ë¶„í•©ë‹ˆë‹¤.")
    else:
        st.error("í‹€ë ¸ìŠµë‹ˆë‹¤ âŒ\nê³±í•œ ë’¤ ì•½ë¶„ì„ í™•ì¸í•˜ì„¸ìš”.")

st.write("---")

# ---------------------
# ë¬¸ì œ 4 (ì•½ë¶„)
# ---------------------
st.subheader("ë¬¸ì œ 4")

st.markdown("ë‹¤ìŒ ìœ ë¦¬ì‹ì„ ê°„ë‹¨íˆ í•œ ê²°ê³¼ë¡œ ì˜³ì€ ê²ƒì€?")
st.latex(r"\frac{x^2-1}{x+1}")

q4 = st.radio(
    "ì„ íƒí•˜ì„¸ìš”.",
    [
        "â‘   \u200b",
        "â‘¡  \u200b",
        "â‘¢  \u200b",
        "â‘£  \u200b",
        "â‘¤  \u200b"
    ],
    key="q4"
)

st.latex(r"â‘ \ x+1")
st.latex(r"â‘¡\ x-1")
st.latex(r"â‘¢\ \frac{x-1}{x+1}")
st.latex(r"â‘£\ \frac{x+1}{x-1}")
st.latex(r"â‘¤\ x^2-1")

if st.button("ë¬¸ì œ 4 ì •ë‹µ í™•ì¸"):
    if q4.startswith("â‘¡"):
        st.success("ì •ë‹µì…ë‹ˆë‹¤! ğŸ‰\nì¸ìˆ˜ë¶„í•´ í›„ ì•½ë¶„í•©ë‹ˆë‹¤.")
    else:
        st.error("í‹€ë ¸ìŠµë‹ˆë‹¤ âŒ\nxÂ²âˆ’1ì„ ì¸ìˆ˜ë¶„í•´í•´ ë³´ì„¸ìš”.")

st.write("---")
st.info("âœ”ï¸ 4ë¬¸ì œë¥¼ ëª¨ë‘ ë§íˆë©´ ìœ ë¦¬ì‹ì˜ ê¸°ë³¸ ì—°ì‚°ì„ ì˜ ì´í•´í•œ ê²ƒì…ë‹ˆë‹¤.")
